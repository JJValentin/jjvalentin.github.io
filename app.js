// Slide data - Updated to remove Implementation Timeline and have 14 slides total
const slidesData = {
  "slides": [
    {
      "id": 1,
      "title": "Strategic Growth Plan: Your Finance Channel",
      "subtitle": "A Complete Implementation Guide<br>Based on 'The Ultimate Creator & Offer Playbook'",
      "type": "title"
    },
    {
      "id": 2,
      "title": "The Three-Phase Strategy",
      "content": [
        {
          "phase": "Phase 1: Market Intelligence Deep Dive",
          "description": "Understand your audience's psychology and the market landscape"
        },
        {
          "phase": "Phase 2: Build Your Content Engine", 
          "description": "Create and distribute content to attract, engage, and build trust"
        },
        {
          "phase": "Phase 3: Architect Your Offers",
          "description": "Develop products and services your audience will want to buy"
        }
      ],
      "type": "phases"
    },
    {
      "id": 3,
      "title": "Phase 1: Market Intelligence Deep Dive",
      "content": "Success starts with a profound understanding of who you're talking to and the market you operate in.",
      "focus_areas": [
        "Psychological profiling of your ideal follower",
        "Identifying core challenges and limiting beliefs",
        "Understanding decision-making patterns",
        "Analyzing current market conditions"
      ],
      "type": "focus_areas"
    },
    {
      "id": 4,
      "title": "The Psychological Profile of Your Follower",
      "content": "Your audience is sophisticated, motivated, and skeptical. They are driven by deep-seated motivations and held back by specific fears.",
      "details": {
        "motivations": "Core Motivations: A blend of gain and security",
        "towards": "• Towards: Status, significant financial gain, outperforming the market",
        "away_from": "• Away From: Loss of wealth, risk, and financial insecurity",
        "insight": "Actionable Insight: Frame strategies as the smarter, safer way to grow wealth."
      },
      "type": "profile"
    },
    {
      "id": 5,
      "title": "Primary Challenges & Limiting Beliefs",
      "content": "Your content must proactively dismantle the internal narratives that prevent action.",
      "challenges": [
        {
          "type": "Helplessness (\"I can't do it\"):",
          "examples": ["\"Commercial real estate is too complex\"", "\"I don't have enough capital or connections\""]
        },
        {
          "type": "Hopelessness (\"It's impossible\"):",
          "examples": ["\"The market is too competitive\"", "\"It's too late to make real money\""]
        },
        {
          "type": "Worthlessness (\"I'm not smart enough\"):",
          "examples": ["Feeling unqualified to understand high-level finance"]
        }
      ],
      "type": "challenges"
    },
    {
      "id": 6,
      "title": "How Your Audience Makes Decisions",
      "content": "Based on the NHB+ Market Criteria, your audience is likely:",
      "criteria": [
        {
          "type": "Procedural",
          "description": "They prefer clear, step-by-step instructions and proven frameworks"
        },
        {
          "type": "Externally Referenced", 
          "description": "They seek expert validation, data, case studies, and testimonials"
        },
        {
          "type": "Thinking/Logical Oriented",
          "description": "They respond to data, facts, and logical arguments"
        }
      ],
      "type": "decisions"
    },
    {
      "id": 7,
      "title": "The State of Your Market",
      "content": "Market Momentum: Expanding",
      "description": "The demand for financial education is growing due to economic uncertainty and increased interest in alternative investments.",
      "indicators": [
        "Rising interest in real estate investing",
        "Growing distrust of traditional financial advice", 
        "Increased demand for practical, actionable education"
      ],
      "type": "market"
    },
    {
      "id": 8,
      "title": "Phase 2: The Content Engine Strategy",
      "content": "Your content must serve a dual purpose:",
      "purposes": [
        "1. Attract your ideal follower",
        "2. Systematically dismantle limiting beliefs that prevent action"
      ],
      "strategy": {
        "name": "Strategy: Strategy-Led Content Engine Model",
        "points": [
          "Start with comprehensive, authoritative long-form content",
          "Break it down into smaller, digestible pieces",
          "Cater to your audience's procedural and logical orientation"
        ]
      },
      "type": "content_strategy"
    },
    {
      "id": 9,
      "title": "Core Content Focus: Addressing Limiting Beliefs",
      "beliefs": [
        {
          "belief": "Helplessness (\"I can't do it\"):",
          "strategy": "Provide simple, actionable steps, tools, and templates",
          "content": "\"The 7-Step Framework for Vetting a Commercial Property\""
        },
        {
          "belief": "Hopelessness (\"It's impossible\"):",
          "strategy": "Instill hope with success stories and achievable futures",
          "content": "\"How a 35-Year-Old Teacher Acquired Their First Rental Property\""
        },
        {
          "belief": "Worthlessness (\"I'm not smart enough\"):",
          "strategy": "Build confidence with clear data and external validation",
          "content": "\"You Don't Need a Finance Degree to Understand Cap Rates\""
        }
      ],
      "type": "belief_content"
    },
    {
      "id": 10,
      "title": "Content Pillars & Format Strategy",
      "pillars": {
        "title": "Core Content Pillars:",
        "items": [
          "Deal Analysis & Due Diligence Frameworks",
          "Creative Financing & Capital Stacking",
          "Risk Mitigation & Asset Protection",
          "Market Cycles & Trend Analysis"
        ]
      },
      "formats": {
        "title": "Content Format Strategy:",
        "long_form": "Long-Form (Weekly): In-depth YouTube videos or detailed newsletters",
        "short_form": "Short-Form (Daily): Reels, Shorts, and social media posts repurposed from pillar content"
      },
      "type": "content_pillars"
    },
    {
      "id": 11,
      "title": "Phase 3: The Offer Architecture Strategy",
      "content": "Your offers must be a logical extension of your content, guiding followers from skepticism to conviction.",
      "approach": {
        "name": "Approach: The Reductive Method",
        "steps": [
          "Envision the ultimate solution",
          "Break it down into a sequence of ascending offers",
          "Use the Solution-Problem Model: each solution creates a new, higher-level problem"
        ]
      },
      "result": "This creates a clear customer journey from DIY learner to high-value partner.",
      "type": "offer_strategy"
    },
    {
      "id": 12,
      "title": "The Complete Offer Funnel",
      "offers": [
        {
          "name": "Front-End Offer ($47): \"The Deal-Ready Toolkit\"",
          "problem": "Problem Solved: Initial helplessness and overwhelm",
          "format": "Format: Digital product with video trainings, checklists, spreadsheet templates"
        },
        {
          "name": "Upsell 1 ($497): \"The Capital Stack Accelerator\"",
          "problem": "New Problem: \"I found a deal, but how do I fund it?\"",
          "format": "Format: Done-With-You masterclass on creative financing"
        },
        {
          "name": "Back-End Offer: \"The Investor Syndicate\"",
          "problem": "New Problem: \"I want to scale faster and access bigger deals\"",
          "format": "Format: Application-only mastermind or co-investment group"
        }
      ],
      "type": "offer_funnel"
    },
    {
      "id": 13,
      "title": "Strategic Overlays for Finance Market",
      "requirements": {
        "title": "Business Opportunity (BizOp) Requirements:",
        "items": [
          "Provide Ethical BizOp: Legitimate, math-backed business models",
          "Change Success Metrics: Celebrate leading indicators like \"First Deal Analyzed\"",
          "Use \"Functional Free\" Positioning: Frame value in terms of risk avoidance"
        ]
      },
      "example": "Example: \"This toolkit could save you tens of thousands by helping you spot one bad deal. If it does that just once, it has paid for itself hundreds of times over.\"",
      "type": "strategic_overlays"
    },
    {
      "id": 14,
      "title": "Key Success Metrics",
      "metrics": [
        {
          "category": "Leading Indicators:",
          "items": [
            "Content engagement rates and follower growth",
            "Email list growth and open rates",
            "Social media reach and shares"
          ]
        },
        {
          "category": "Revenue Indicators:",
          "items": [
            "Front-end offer conversion rates",
            "Customer lifetime value (CLTV)",
            "Upsell and cross-sell performance"
          ]
        },
        {
          "category": "Long-term Goals:",
          "items": [
            "Build authority in finance/real estate space",
            "Create predictable revenue streams",
            "Develop high-value partnerships and opportunities"
          ]
        }
      ],
      "type": "metrics"
    }
  ]
};

class SlidePresentation {
  constructor() {
    this.slides = slidesData.slides;
    this.currentSlideIndex = 0;
    this.totalSlides = this.slides.length;
    
    this.slideContainer = document.getElementById('slideContainer');
    this.prevBtn = document.getElementById('prevBtn');
    this.nextBtn = document.getElementById('nextBtn');
    this.slideIndicators = document.getElementById('slideIndicators');
    this.currentSlideEl = document.getElementById('currentSlide');
    this.totalSlidesEl = document.getElementById('totalSlides');
    this.progressFill = document.getElementById('progressFill');
    
    this.init();
  }
  
  init() {
    this.renderSlides();
    this.renderIndicators();
    this.setupEventListeners();
    this.updateDisplay();
    this.updateProgress();
  }
  
  renderSlides() {
    this.slideContainer.innerHTML = '';
    
    this.slides.forEach((slide, index) => {
      const slideEl = document.createElement('div');
      slideEl.className = `slide slide--${slide.type === 'title' ? 'title' : 'content'}`;
      slideEl.setAttribute('data-slide', index);
      
      if (index === 0) {
        slideEl.classList.add('active');
      }
      
      slideEl.innerHTML = this.renderSlideContent(slide);
      this.slideContainer.appendChild(slideEl);
    });
  }
  
  renderSlideContent(slide) {
    switch (slide.type) {
      case 'title':
        return `
          <h1>${slide.title}</h1>
          <div class="subtitle">${slide.subtitle}</div>
        `;
        
      case 'phases':
        return `
          <h2>${slide.title}</h2>
          <div class="phases-grid">
            ${slide.content.map(phase => `
              <div class="phase-card">
                <h3>${this.escapeHtml(phase.phase)}</h3>
                <p>${this.escapeHtml(phase.description)}</p>
              </div>
            `).join('')}
          </div>
        `;
        
      case 'focus_areas':
        return `
          <h2>${slide.title}</h2>
          <p class="slide-description">${slide.content}</p>
          <div class="focus-areas">
            <h4>Key Focus Areas:</h4>
            <ul class="focus-list">
              ${slide.focus_areas.map(area => `<li>${this.escapeHtml(area)}</li>`).join('')}
            </ul>
          </div>
        `;
        
      case 'profile':
        return `
          <h2>${slide.title}</h2>
          <p class="slide-description">${slide.content}</p>
          <div class="profile-details">
            <div class="profile-item">
              <h4>${this.escapeHtml(slide.details.motivations)}</h4>
              <p>${this.escapeHtml(slide.details.towards)}</p>
              <p>${this.escapeHtml(slide.details.away_from)}</p>
            </div>
          </div>
          <div class="insight-highlight">
            <h4>Actionable Insight</h4>
            <p>${this.escapeHtml(slide.details.insight)}</p>
          </div>
        `;
        
      case 'challenges':
        return `
          <h2>${slide.title}</h2>
          <p class="slide-description">${slide.content}</p>
          <div class="challenges-list">
            ${slide.challenges.map(challenge => `
              <div class="challenge-item">
                <h4>${this.escapeHtml(challenge.type)}</h4>
                <ul class="challenge-examples">
                  ${challenge.examples.map(example => `<li>${this.escapeHtml(example)}</li>`).join('')}
                </ul>
              </div>
            `).join('')}
          </div>
        `;
        
      case 'decisions':
        return `
          <h2>${slide.title}</h2>
          <p class="slide-description">${slide.content}</p>
          <div class="criteria-list">
            ${slide.criteria.map(criterion => `
              <div class="criteria-item">
                <div class="criteria-content">
                  <h4>${this.escapeHtml(criterion.type)}</h4>
                  <p>${this.escapeHtml(criterion.description)}</p>
                </div>
              </div>
            `).join('')}
          </div>
        `;
        
      case 'market':
        return `
          <h2>${slide.title}</h2>
          <div class="market-status">
            <div class="market-momentum">${this.escapeHtml(slide.content)}</div>
            <p class="market-description">${this.escapeHtml(slide.description)}</p>
            <div class="market-indicators">
              <h4>Key Market Indicators:</h4>
              <ul class="indicator-list">
                ${slide.indicators.map(indicator => `<li>${this.escapeHtml(indicator)}</li>`).join('')}
              </ul>
            </div>
          </div>
        `;

      case 'content_strategy':
        return `
          <h2>${slide.title}</h2>
          <p class="slide-description">${slide.content}</p>
          <ul class="purpose-list">
            ${slide.purposes.map(purpose => `<li>${this.escapeHtml(purpose)}</li>`).join('')}
          </ul>
          <div class="strategy-highlight">
            <h4>${this.escapeHtml(slide.strategy.name)}</h4>
            <ul class="strategy-points">
              ${slide.strategy.points.map(point => `<li>${this.escapeHtml(point)}</li>`).join('')}
            </ul>
          </div>
        `;

      case 'belief_content':
        return `
          <h2>${slide.title}</h2>
          <div class="belief-grid">
            ${slide.beliefs.map(belief => `
              <div class="belief-card">
                <h4>${this.escapeHtml(belief.belief)}</h4>
                <p class="strategy-text"><strong>Strategy:</strong> ${this.escapeHtml(belief.strategy)}</p>
                <p class="content-text"><strong>Content:</strong> ${this.escapeHtml(belief.content)}</p>
              </div>
            `).join('')}
          </div>
        `;

      case 'content_pillars':
        const longFormText = slide.formats.long_form.includes(':') ? 
          slide.formats.long_form.split(': ')[1] : slide.formats.long_form;
        const shortFormText = slide.formats.short_form.includes(':') ? 
          slide.formats.short_form.split(': ')[1] : slide.formats.short_form;
        
        return `
          <h2>${slide.title}</h2>
          <div class="pillars-section">
            <h4>${this.escapeHtml(slide.pillars.title)}</h4>
            <ul class="pillars-list">
              ${slide.pillars.items.map(item => `<li>${this.escapeHtml(item)}</li>`).join('')}
            </ul>
          </div>
          <div class="formats-section">
            <h4>${this.escapeHtml(slide.formats.title)}</h4>
            <div class="format-item">
              <p><strong>Long-Form (Weekly):</strong> ${this.escapeHtml(longFormText)}</p>
              <p><strong>Short-Form (Daily):</strong> ${this.escapeHtml(shortFormText)}</p>
            </div>
          </div>
        `;

      case 'offer_strategy':
        return `
          <h2>${slide.title}</h2>
          <p class="slide-description">${slide.content}</p>
          <div class="approach-section">
            <h4>${this.escapeHtml(slide.approach.name)}</h4>
            <ul class="approach-steps">
              ${slide.approach.steps.map(step => `<li>${this.escapeHtml(step)}</li>`).join('')}
            </ul>
          </div>
          <div class="result-highlight">
            <p>${this.escapeHtml(slide.result)}</p>
          </div>
        `;

      case 'offer_funnel':
        return `
          <h2>${slide.title}</h2>
          <div class="offers-grid">
            ${slide.offers.map(offer => `
              <div class="offer-card">
                <h4>${this.escapeHtml(offer.name)}</h4>
                <p class="offer-problem">${this.escapeHtml(offer.problem)}</p>
                <p class="offer-format">${this.escapeHtml(offer.format)}</p>
              </div>
            `).join('')}
          </div>
        `;

      case 'strategic_overlays':
        return `
          <h2>${slide.title}</h2>
          <div class="requirements-section">
            <h4>${this.escapeHtml(slide.requirements.title)}</h4>
            <ul class="requirements-list">
              ${slide.requirements.items.map(item => `<li>${this.escapeHtml(item)}</li>`).join('')}
            </ul>
          </div>
          <div class="example-highlight">
            <h4>Example:</h4>
            <p>${this.escapeHtml(slide.example)}</p>
          </div>
        `;

      case 'metrics':
        return `
          <h2>${slide.title}</h2>
          <div class="metrics-grid">
            ${slide.metrics.map(metric => `
              <div class="metric-card">
                <h4>${this.escapeHtml(metric.category)}</h4>
                <ul class="metric-items">
                  ${metric.items.map(item => `<li>${this.escapeHtml(item)}</li>`).join('')}
                </ul>
              </div>
            `).join('')}
          </div>
        `;
        
      default:
        return `<h2>${slide.title}</h2><p>${slide.content || ''}</p>`;
    }
  }
  
  escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  renderIndicators() {
    this.slideIndicators.innerHTML = '';
    
    for (let i = 0; i < this.totalSlides; i++) {
      const indicator = document.createElement('div');
      indicator.className = 'indicator';
      indicator.setAttribute('data-slide', i);
      
      if (i === 0) {
        indicator.classList.add('active');
      }
      
      indicator.addEventListener('click', (e) => {
        e.stopPropagation();
        this.goToSlide(i);
      });
      this.slideIndicators.appendChild(indicator);
    }
  }
  
  setupEventListeners() {
    // Button navigation
    this.prevBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      this.previousSlide();
    });
    this.nextBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      this.nextSlide();
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          this.previousSlide();
          break;
        case 'ArrowRight':
        case ' ':
          e.preventDefault();
          this.nextSlide();
          break;
      }
    });

    // Click to advance
    this.slideContainer.addEventListener('click', (e) => {
      // Only advance if clicking on the slide container itself, not on buttons or other interactive elements
      if (e.target === this.slideContainer || e.target.closest('.slide')) {
        this.nextSlide();
      }
    });
  }
  
  nextSlide() {
    if (this.currentSlideIndex < this.totalSlides - 1) {
      this.goToSlide(this.currentSlideIndex + 1);
    }
  }
  
  previousSlide() {
    if (this.currentSlideIndex > 0) {
      this.goToSlide(this.currentSlideIndex - 1);
    }
  }
  
  goToSlide(index) {
    if (index >= 0 && index < this.totalSlides && index !== this.currentSlideIndex) {
      // Remove active class from current slide
      const currentSlide = document.querySelector('.slide.active');
      if (currentSlide) {
        currentSlide.classList.remove('active');
        if (index < this.currentSlideIndex) {
          currentSlide.classList.add('prev');
        }
        
        // Remove prev class after transition
        setTimeout(() => {
          if (currentSlide) {
            currentSlide.classList.remove('prev');
          }
        }, 300);
      }
      
      // Update current slide index
      this.currentSlideIndex = index;
      
      // Add active class to new slide
      const newSlide = document.querySelector(`[data-slide="${index}"]`);
      if (newSlide) {
        newSlide.classList.add('active');
      }
      
      this.updateDisplay();
      this.updateProgress();
      this.updateIndicators();
    }
  }
  
  updateDisplay() {
    // Update slide counter
    this.currentSlideEl.textContent = this.currentSlideIndex + 1;
    this.totalSlidesEl.textContent = this.totalSlides;
    
    // Update button states
    this.prevBtn.disabled = this.currentSlideIndex === 0;
    this.nextBtn.disabled = this.currentSlideIndex === this.totalSlides - 1;
  }
  
  updateProgress() {
    const progress = ((this.currentSlideIndex + 1) / this.totalSlides) * 100;
    this.progressFill.style.width = `${progress}%`;
  }
  
  updateIndicators() {
    // Remove active class from all indicators
    document.querySelectorAll('.indicator').forEach(indicator => {
      indicator.classList.remove('active');
    });
    
    // Add active class to current indicator
    const currentIndicator = document.querySelector(`.indicator[data-slide="${this.currentSlideIndex}"]`);
    if (currentIndicator) {
      currentIndicator.classList.add('active');
    }
  }
}

// Initialize the presentation when the DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  new SlidePresentation();
});